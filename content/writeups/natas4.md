---
title: "Natas4"
date: 2023-11-15T18:49:07Z
draft: false
toc: false
images:
tags: 
  - untagged
---
# Natas 4 -> Natas 5

| url | http://natas4.natas.labs.overthewire.org/ | 
|---| -- |

> **Keywords\*:** HTTP Request Headers, web proxies
> *\*  if you are stuck with this and don't know where to start or even look, you can research the keywords instead of reading the whole write-up. This will give you the chance to solve the challenge yourself with just a small hint *

> **Questions to ask:**
> How does the webserver know where I come from?
> How can I manipulate information that I provide to the webserver?
 

## Getting an overview
![Pasted image 20231003101253.png](/Pasted%20image%2020231003101253.png)

This time the all-knowing textbox says that we are not allowed to access this page. The reason given is that we are not visiting from 'http://natas5.natas.labs.overthewire.org/' but instead from '' (meaning we have accessed this website directly and not been referred by another page). However, how are we supposed to access the website from 'http://natas5.natas.labs.overthewire.org/' if we don't have access to this yet (because it is the next level)? And how does the webserver know where we come from?

## Checking the HTTP headers
The answer to this lies in the HTTP request our browser send out. In my case the request is as follows:
```
GET / HTTP/1.1
Host: natas4.natas.labs.overthewire.org
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/117.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Authorization: Basic bmF0YXM0OnRLT2NKSWJ6TTRsVHM4aGJDbXpuNVpyNDQzNGZHWlFt
Connection: keep-alive
Cookie: __utma=176859643.1047432696.1695548466.1696261589.1696327732.6; __utmz=176859643.1695548466.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmb=176859643.3.10.1696327732; __utmc=176859643; __utmt=1
Upgrade-Insecure-Requests: 1
```
We can see all the basic components of an HTTP GET request. The host the user-agen and so on. We can also see (or rather not see) the referrer. Since there is no `Referer` field provided, that is probably the reason the webserver says we accessed the website from " " (see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer)

> In [HTTP](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol "Hypertext Transfer Protocol"), "**Referer**" (a misspelling of **Referrer**[[1]](https://en.wikipedia.org/wiki/HTTP_referer#cite_note-s3T5A-1)) is an optional [HTTP header field](https://en.wikipedia.org/wiki/List_of_HTTP_header_fields "List of HTTP header fields") that identifies the address of the [web page](https://en.wikipedia.org/wiki/Web_page "Web page") (i.e., the [URI](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier "Uniform Resource Identifier") or [IRI](https://en.wikipedia.org/wiki/Internationalized_Resource_Identifier "Internationalized Resource Identifier")), from which the resource has been requested. (https://en.wikipedia.org/wiki/HTTP_referer)

## Changing/Faking the referrer 

In order to manipulate the HTTP request we are sending to the browser we will use the burp suite. A very popular browser penetration testing toolkit. However in order to understand what we want to do and not just how to click in a tool let's walk through the theoretical steps first:
Lets recap what we know so far:
What do we want to do: We want to access 'http://natas4.natas.labs.overthewire.org/' with the username and password combination we have found in the previous level and find the password for natas5 there. However unfortunately we can't access the site because our referrer is not set to 'http://natas5.natas.labs.overthewire.org/'. Actually accessing from this address is not an option because we don't have the password yet. So we need to fake it till we make it.
To do that we need to 
1. intercept the http request generated by our browser before it is sent to the webserver
2. change the header fields by adding `Referer: http://natas5.natas.labs.overthewire.org/'` to it
3. send it to the webserver
4. profit (hopefully)

Now let's see how this is done in burpsuite:
After the general setup of installing the tool and creating a new temporary project we need to open the browser and make sure that HTTP interception is turned off:
![Pasted image 20231003105034.png](/Pasted%20image%2020231003105034.png)

Now we have a second window open containing a standard browser view. Here we can enter the address we want to visit.
After providing username and passwort we are sent to the same site as in the beginning. Now we need to turn the interception on and refresh the page.
When refreshing we will notice that the request is not immediately performed by the browser but instead seems to be stuck. That's the case because we turned on interception and the browser is waiting for us to manipulate the request in the proxy and then forward it again.
So back in the Proxy window we can now see the request as it was created by the browser (the 'default'):
![Pasted image 20231003110314.png](/Pasted%20image%2020231003110314.png)
We can also confirm again that no `Referer` header is given. So let's change that:
![Pasted image 20231003110354.png](/Pasted%20image%2020231003110354.png)

The final header should then be

```
GET /index.php HTTP/1.1
Host: natas4.natas.labs.overthewire.org
Authorization: Basic bmF0YXM0OnRLT2NKSWJ6TTRsVHM4aGJDbXpuNVpyNDQzNGZHWlFt
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.110 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://natas4.natas.labs.overthewire.org/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Connection: close
Referer: http://natas5.natas.labs.overthewire.org/
```
Now that we added the necessary header we can 'forward' the request from the proxy and tadaa we can see the following page in the browser:
## Profit
![Pasted image 20231003104318.png](/Pasted%20image%2020231003104318.png)

> **Hint**: I loaded the page once without the interception to get an authorized session

## Further Reading
https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer
https://medium.com/nerd-for-tech/how-to-manipulate-web-requests-ea5cf1c80a90‚èé  
